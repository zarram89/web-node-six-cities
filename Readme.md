# Проект «Шесть городов»

**«Шесть городов»** — сервис для путешественников, не желающих переплачивать за аренду жилья. Выбирайте один из шести популярных городов для путешествий и получайте актуальный список предложений по аренде.

---

## Техническое задание

### 1. Задача
1.1. Разработать сервис для проекта «Шесть городов».

1.2. Сервис предоставляет REST API интерфейс и CLI интерфейс.

1.3. Соединить бэкенд (сервис) с фронтендом (дополнительное задание).

### 2. Сценарии
2.1. Создание нового предложения.

2.2. Редактирование предложения.

2.3. Удаление предложения.

2.4. Получение списка предложений по аренде.

2.5. Получение детальной информации о предложении.

2.6. Получение списка комментариев для предложения.

2.7. Добавление комментария для предложения.

2.8. Создание нового пользователя.

2.9. Вход в закрытую часть приложения.

2.10. Выход из закрытой части приложения.

2.11. Проверка состояния пользователя.

2.12. Получение списка премиальных предложений для города.

2.13. Получения списка предложений, добавленных в избранное.

2.14. Добавление/удаление предложения в/из избранное.

### 3. Сущности

#### 3.1 Пользователь
3.1.1. Пользователь представлен набором информации:

- Имя. Обязательное. Мин. длина 1 символ, макс. длина 15 символов;
- Электронная почта. Обязательное. Валидный адрес электронной почты;
- Аватар пользователя. Необязательное. Изображение пользователя в формате .jpg или .png;
- Пароль. Обязательное. Мин. длина 6 символов, макс. длина 12 символов;
- Тип пользователя. Обязательное. Возможные варианты: обычный, pro.

3.1.2. В приложении не может быть двух пользователей с одинаковым email.

3.1.3. Изображение для аватарки. Необязательное. Если пользователь не загрузил аватар, сервис возвращает изображение аватарки по умолчанию.

#### 3.2. Предложение по аренде
3.2.1. Предложение по аренде представлено набором информации:

- Наименование. Обязательное. Мин. длина 10 символов, макс. длина 100;
- Описание предложения. Обязательное. Мин. длина 20 символов, макс. длина 1024 символа;
- Дата публикации предложения. Обязательное.
- Город. Обязательное. Один из шести городов.
- Превью изображения. Обязательное.
- Фотографии жилья. Обязательное. Список ссылок на фотографии жилья. Всегда 6 фотографий;
- Флаг «Премиум». Обязательное.
- Флаг «Избранное». Обязательное.
- Рейтинг. Обязательное. Число от 1 до 5. Допускаются числа с запятой (1 знак после запятой);
- Тип жилья. Обязательное. Один из вариантов: apartment, house, room, hotel;
- Количество комнат. Обязательное. Мин. 1, Макс. 8;
- Количество гостей. Обязательное. Мин. 1, Макс. 10;
- Стоимость аренды. Обязательное. Мин. 100, Макс. 100 000;
- Удобства. Обязательное. Список удобств: Breakfast, Air conditioning, Laptop friendly workspace, Baby seat, Washer, Towels, Fridge;
- Автор предложения. Обязательное. Ссылка на сущность «Пользователь»;
- Количество комментариев. Рассчитывается автоматически;
- Координаты предложения для аренды. Обязательное.

3.2.2. Список городов и их географические координаты:

- Paris (latitude: 48.85661, longitude: 2.351499);
- Cologne (latitude: 50.938361, longitude: 6.959974);
- Brussels (latitude: 50.846557, longitude: 4.351697);
- Amsterdam (latitude: 52.370216, longitude: 4.895168);
- Hamburg (latitude: 53.550341, longitude: 10.000654);
- Dusseldorf (latitude: 51.225402, longitude: 6.776314).

#### 3.3. Комментарий
3.3.1. Комментарий представлен набором информации:

- Текст комментария. Обязательное. Мин. длина 5 символов, макс. длина 1024 символа;
- Дата публикации комментария. Обязательное.
- Рейтинг. Обязательное. Число от 1 до 5;
- Автор комментария. Обязательное. Ссылка на сущность «Пользователь».

### 4. Функциональность

#### 4.1. Command Line Interface
4.1.1. Приложение предоставляет Command Line Interface (CLI). Для запуска CLI предусмотрен отдельный сценарий в package.json — cli.

4.1.2. Модуль, отвечающий за запуск CLI, содержит корректный shebang.

4.1.3. CLI поддерживает обработку аргументов:

- `--version`. Выводит информацию о версии приложения;
- `--help`. Выводит список и описание всех поддерживаемых аргументов;
- `--generate <n> <filepath> <url>`. Создаёт файл в формате tsv с тестовыми данными;
- `--import <filepath>`. Импортирует в базу данных информацию из tsv-файла.

4.1.4. Запуск CLI без аргументов приводит к исполнению команды `--help`.

*Полный текст ТЗ доступен в пункте "Полное техническое задание" ниже.*

---

## Модуль 1. Задание 1 (module1-task1): CLI приложение

### Описание задания

Работу над проектом начинаем с создания приложения с интерфейсом для командной строки. Это приложение выполняет задачу для поддержания общей инфраструктуры — помогает генерировать тестовые данные и импортировать их в базу данных.

**Требования:**

1. Создать директорию `mocks`, а в ней тестовый файл в формате TSV с данными для создания двух предложений об аренде.
2. Подготовить описание типов для сущностей (опираясь на техническое задание проекта).
3. Реализовать приложение с CLI интерфейсом, поддерживающее следующие команды:
   - `--help` — выводит информацию о списке поддерживаемых команд (по умолчанию)
   - `--version` — выводит информацию о версии приложения из package.json
   - `--import` — импортирует данные из *.tsv-файла и выводит результат в консоль
4. Добавить корректный shebang для сценария, который реализует CLI.
5. Раскрасить вывод информации в консоли с помощью пакета `chalk`.

### Решение

#### 1. Установка зависимостей

Установлен пакет `chalk` версии 5.x (для ES-модулей):

```bash
npm install chalk
```

#### 2. Определение типов данных

Созданы типы для всех сущностей проекта:

**Файловая структура:**
```
src/shared/types/
├── user.type.ts        # UserType enum, User interface
├── offer.type.ts       # City, HousingType, Amenity enums, Coordinates, Offer interfaces
├── comment.type.ts     # Comment interface
└── index.ts           # Централизованный экспорт всех типов
```

**Ключевые типы:**
- `UserType`: enum с значениями `Standard`, `Pro`
- `User`: интерфейс с полями name, email, avatarUrl?, password, type
- `City`: enum с 6 городами (Paris, Cologne, Brussels, Amsterdam, Hamburg, Dusseldorf)
- `HousingType`: enum (Apartment, House, Room, Hotel)
- `Amenity`: enum с 7 удобствами
- `Offer`: интерфейс с 20+ полями согласно ТЗ
- `Comment`: интерфейс для комментариев

#### 3. Создание mock-данных

Создан файл `mocks/offers.tsv` с двумя тестовыми предложениями:
- Luxurious Apartment in Central Paris (премиум)
- Cozy Room near Amsterdam Center (стандарт)

**Формат TSV:**
- Поля разделены табуляцией (`\t`)
- Массивы (фотографии, удобства) разделены точкой с запятой (`;`)
- Первая строка — заголовки полей

#### 4. CLI Implementation

**Архитектура CLI:**

```
src/
├── cli.ts                          # Точка входа с shebang
├── cli/
│   ├── command-parser.ts          # Парсер аргументов, маршрутизация команд
│   └── commands/
│       ├── command.interface.ts   # Интерфейс Command
│       ├── help.command.ts        # Команда --help
│       ├── version.command.ts     # Команда --version
│       └── import.command.ts      # Команда --import
└── shared/
    └── helpers/
        └── tsv-parser.ts          # Парсер TSV файлов
```

**Реализованные команды:**

1. **HelpCommand** (`--help`):
   - Выводит цветной список всех доступных команд
   - Используется по умолчанию

2. **VersionCommand** (`--version`):
   - Читает версию из `package.json`
   - Выводит версию приложения

3. **ImportCommand** (`--import <filepath>`):
   - Читает TSV файл построчно с использованием Streams (Node.js Streams API)
   - Парсит каждую строку в объект `Offer`
   - Выводит детальную информацию о каждом импортированном предложении с цветным форматированием
   - Обрабатывает ошибки (файл не найден, неверный формат)

**TSV Parser:**
- Класс `TSVParser` с методом `parseOffer(line: string): Offer | null`
- Разделение строки по табуляции
- Преобразование типов (string → Date, number, enum)
- Валидация количества полей
- Обработка ошибок парсинга

**Command Parser:**
- Класс `CommandParser` для парсинга `process.argv`
- Регистрация команд через `registerCommand()`
- Асинхронная поддержка команд (async/await)
- Выполнение команды по умолчанию (`--help`) при отсутствии аргументов

#### 5. Цветной вывод

Использован пакет `chalk` для раскрашивания консольного вывода:
- **Cyan**: заголовки, акценты
- **Green**: успешные операции, премиум-флаг
- **Yellow**: важные значения (город, рейтинг)
- **Red**: ошибки
- **Gray**: второстепенная информация
- **Bold**: выделение важной информации

#### 6. Обновление конфигурации

**package.json:**
- Добавлен скрипт `"cli": "npm run ts -- ./src/cli.ts"`

**Workflow.md:**
- Добавлена секция "Команды CLI" с описанием всех команд
- Примеры использования для каждой команды

**src/cli.ts:**
- Добавлен shebang: `#!/usr/bin/env node`

#### 7. Тестирование

Все команды протестированы вручную:

✅ **Команда --help:**
```bash
node ./dist/cli.js --help
# Вывод: цветной список всех команд
```

✅ **Команда --version:**
```bash
node ./dist/cli.js --version
# Вывод: 7.0.0
```

✅ **Команда --import:**
```bash
node ./dist/cli.js --import ./mocks/offers.tsv
# Вывод: Импортировано 2 предложения с детальной информацией
```

✅ **Компиляция TypeScript:**
```bash
npm run compile
# Успешно скомпилирован в dist/
```

✅ **ESLint:**
```bash
npm run lint
# Все файлы соответствуют стандартам кодирования
```

### Технические детали реализации

1. **Использование Streams**: Файл читается построчно через `createReadStream` и `readline.createInterface`, что эффективно для больших файлов.

2. **Асинхронность**: Команда `import` реализована как async/await для корректной работы с потоками.

3. **Типизация**: Строгая типизация TypeScript с использованием интерфейсов и enum для всех сущностей.

4. **Обработка ошибок**: Проверка наличия файла, валидация формата TSV, обработка ошибок парсинга.

5. **Модульность**: Каждая команда — отдельный класс, реализующий интерфейс `Command`.

6. **Code Style**: Соблюдение ESLint правил htmlacademy/node с отступами в 2 пробела.

### Структура проекта после выполнения задания

```
web-node-six-cities/
├── mocks/
│   └── offers.tsv                  # Тестовые данные (2 предложения)
├── src/
│   ├── cli.ts                      # CLI entry point с shebang
│   ├── main.ts                     # Main entry point (пусто)
│   ├── cli/
│   │   ├── command-parser.ts       # Парсер CLI аргументов
│   │   └── commands/
│   │       ├── command.interface.ts
│   │       ├── help.command.ts
│   │       ├── version.command.ts
│   │       └── import.command.ts
│   └── shared/
│       ├── types/
│       │   ├── user.type.ts
│       │   ├── offer.type.ts
│       │   ├── comment.type.ts
│       │   └── index.ts
│       └── helpers/
│           └── tsv-parser.ts       # TSV парсер
├── package.json                    # Добавлен скрипт cli и зависимость chalk
├── Workflow.md                     # Обновлен с документацией CLI
└── Readme.md                       # Этот файл
```

### Использование

```bash
# Установка зависимостей
npm install

# Компиляция проекта
npm run compile

# Запуск CLI
node ./dist/cli.js                           # --help по умолчанию
node ./dist/cli.js --help                   # Список команд
node ./dist/cli.js --version                # Версия приложения
node ./dist/cli.js --import ./mocks/offers.tsv  # Импорт данных
```

---

## Полное техническое задание

<details>
<summary>Развернуть полное ТЗ</summary>

### Проект «Шесть городов» - Полное техническое задание

*(здесь будет весь текст технического задания, который вы предоставили - 9. Технические требования и далее)*

### 9. Технические требования
9.1. Проект запускается и работает в актуальной версии Node.js.

9.2. Для разработки проекта используется TypeScript.

9.3. Для хранения данных используется MongoDB.

9.4. Для обработки запросов от клиентов используется Express.js.

9.5. Для работы с большими файлами используются потоки (Streams).

9.6. В коде не должно быть зашито данных, которые могут меняться при переносе в продуктовую среду.

9.7. Замена пакетов допускается по согласованию с наставником.

</details>

---

## Разработка

Подробную информацию о командах и сценариях смотрите в [Workflow.md](./Workflow.md).

---

<a href="https://htmlacademy.ru/profession/fullstack"><img align="left" width="50" height="50" title="HTML Academy" src="https://up.htmlacademy.ru/static/img/intensive/nodejs/logo-for-github-2.png"></a>

Репозиторий создан для обучения на профессиональном онлайн‑курсе «[Node.js. Профессиональная разработка REST API](https://htmlacademy.ru/profession/fullstack)» от [HTML Academy](https://htmlacademy.ru).
